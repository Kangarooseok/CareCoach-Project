<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="com.carecoach.service.mapper.BoardMapper"> 
 
  
   
  
   <select id="selectPostList" resultType="com.carecoach.vo.PostsVO" >
   		<!-- 
   		select * 
   		from posts 
   		where category_id=#{category_id}
   			and is_deleted=0
   		order by updated_dt DESC
   		 -->
   		 
  		SELECT *
		FROM (
		    SELECT
		        ROWNUM AS RNUM, p.*
		    FROM (
		        SELECT *
		        FROM posts p
		        WHERE category_id = #{category_id}
		          AND is_deleted = 0
		        ORDER BY updated_dt DESC
		    ) p
		)
		WHERE RNUM BETWEEN #{StartIndex} AND #{CntPerPage}

	 		
   </select>
   
   
   <select id="selectPostCnt" resultType="int">
   		select count(*) 
   		from posts 
   		where category_id=#{category_id}
   			and is_deleted=0
   </select>
   
    <insert id="insertPost">
			INSERT INTO POSTS
			(id,user_id,category_id,title,url,content)
			VALUES (
			   SEQ_POSTS.nextval,
			   #{user_id},
			   #{category_id},
			   #{title},
			   #{url},
			   #{content}
			)
			

    </insert>
    
    <update id="updatePost">
        update posts set
		   category_id = #{category_id},
		   url = #{url},
		   title = #{title},
		   content = #{content},
		   updated_dt = SYSDATE
		where id = #{id}
    </update>
    
    <update id="addViewCnt">
    	update posts set
    		view_cnt = (select view_cnt from posts where id = #{id}) + 1
   		where id = #{id}
    </update>
    
    
    
    <update id="deletePost">
        update posts set
        	is_deleted=1
        where
           id = #{id}
    </update>
    
    <select id="selectPostsById" parameterType="com.carecoach.vo.PostsVO" resultType="com.carecoach.vo.PostsVO">
        select * from posts
        where
            id = #{id}
    </select>
   
   <select id="selectLikeCnt">
   	select count(*)
   	from likes
   	where post_id=#{post_id}
   </select>
   
   <insert id="addLike">
   		insert into likes
   		(id,user_id,post_id)
   		values
   		(
   			SEQ_LIKES.nextval,
   			#{user_id},
   			#{post_id}
   		)
   		
   </insert>
   <delete id="delLike">
   delete likes 
   where user_id = #{user_id} 
   and post_id=#{post_id};
   </delete>

 </mapper>
 
 
 
 
 
 
 
 
 